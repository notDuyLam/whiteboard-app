<Page
    x:Class="whiteboard_app.Views.ManagementPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:whiteboard_app.Views"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:lvc="using:LiveChartsCore.SkiaSharpView.WinUI"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- BreadcrumbBar -->
        <BreadcrumbBar 
            x:Name="ManagementBreadcrumbBar"
            Grid.Row="0"
            ItemClicked="BreadcrumbBar_ItemClicked"
            Margin="24,16,24,16" />

        <!-- Dashboard View -->
        <ScrollViewer 
            x:Name="DashboardView"
            Grid.Row="1"
            Padding="24"
            Visibility="Visible">
            <StackPanel Spacing="24">
                <!-- Header -->
                <TextBlock 
                    Text="Dashboard"
                    FontSize="36"
                    FontWeight="Bold" />

                <!-- Summary Cards -->
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <!-- Total Profiles Card -->
                    <Border
                        Grid.Column="0"
                        Background="{ThemeResource SystemControlAcrylicElementBrush}"
                        BorderBrush="{ThemeResource SystemControlForegroundBaseMediumLowBrush}"
                        BorderThickness="1"
                        CornerRadius="8"
                        Padding="20"
                        Margin="0,0,12,0">
                        <StackPanel Spacing="8">
                            <TextBlock
                                Text="Total Profiles"
                                FontSize="14"
                                Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}" />
                            <TextBlock
                                x:Name="TotalProfilesTextBlock"
                                Text="0"
                                FontSize="32"
                                FontWeight="Bold" />
                        </StackPanel>
                    </Border>

                    <!-- Total Canvases Card -->
                    <Border
                        Grid.Column="1"
                        Background="{ThemeResource SystemControlAcrylicElementBrush}"
                        BorderBrush="{ThemeResource SystemControlForegroundBaseMediumLowBrush}"
                        BorderThickness="1"
                        CornerRadius="8"
                        Padding="20"
                        Margin="6,0,6,0">
                        <StackPanel Spacing="8">
                            <TextBlock
                                Text="Total Canvases"
                                FontSize="14"
                                Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}" />
                            <TextBlock
                                x:Name="TotalCanvasesTextBlock"
                                Text="0"
                                FontSize="32"
                                FontWeight="Bold" />
                        </StackPanel>
                    </Border>

                    <!-- Total Shapes Card -->
                    <Border
                        Grid.Column="2"
                        Background="{ThemeResource SystemControlAcrylicElementBrush}"
                        BorderBrush="{ThemeResource SystemControlForegroundBaseMediumLowBrush}"
                        BorderThickness="1"
                        CornerRadius="8"
                        Padding="20"
                        Margin="6,0,6,0">
                        <StackPanel Spacing="8">
                            <TextBlock
                                Text="Total Shapes"
                                FontSize="14"
                                Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}" />
                            <TextBlock
                                x:Name="TotalShapesTextBlock"
                                Text="0"
                                FontSize="32"
                                FontWeight="Bold" />
                        </StackPanel>
                    </Border>

                    <!-- Total Templates Card -->
                    <Border
                        Grid.Column="3"
                        Background="{ThemeResource SystemControlAcrylicElementBrush}"
                        BorderBrush="{ThemeResource SystemControlForegroundBaseMediumLowBrush}"
                        BorderThickness="1"
                        CornerRadius="8"
                        Padding="20"
                        Margin="12,0,0,0">
                        <StackPanel Spacing="8">
                            <TextBlock
                                Text="Total Templates"
                                FontSize="14"
                                Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}" />
                            <TextBlock
                                x:Name="TotalTemplatesTextBlock"
                                Text="0"
                                FontSize="32"
                                FontWeight="Bold" />
                        </StackPanel>
                    </Border>
                </Grid>

                <!-- Quick Actions -->
                <StackPanel Spacing="16">
                    <TextBlock 
                        Text="Quick Actions"
                        FontSize="24"
                        FontWeight="SemiBold" />
                    
                    <StackPanel Orientation="Horizontal" Spacing="12">
                        <Button
                            x:Name="CanvasManagerButton"
                            Click="CanvasManagerButton_Click"
                            Style="{StaticResource AccentButtonStyle}"
                            ToolTipService.ToolTip="Open Canvas Manager to view and manage all canvases"
                            AutomationProperties.Name="Canvas Manager"
                            AutomationProperties.HelpText="Click to open the Canvas Manager where you can view, open, and delete all canvases">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <FontIcon Glyph="&#xE8A7;" FontSize="16" />
                                <TextBlock Text="Canvas Manager" />
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </StackPanel>

                <!-- Statistics Charts Section -->
                <StackPanel Spacing="24">
                    <TextBlock 
                        Text="Statistics"
                        FontSize="24"
                        FontWeight="SemiBold" />

                    <!-- Charts Grid -->
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <!-- Shape Type Distribution Chart (Pie Chart) -->
                        <Border
                            Grid.Column="0"
                            Background="{ThemeResource SystemControlAcrylicElementBrush}"
                            BorderBrush="{ThemeResource SystemControlForegroundBaseMediumLowBrush}"
                            BorderThickness="1"
                            CornerRadius="8"
                            Padding="20"
                            Margin="0,0,12,0">
                            <StackPanel Spacing="12">
                                <TextBlock
                                    Text="Shape Type Distribution"
                                    FontSize="18"
                                    FontWeight="SemiBold" />
                                <lvc:PieChart
                                    x:Name="ShapeTypePieChart"
                                    Height="300" />
                            </StackPanel>
                        </Border>

                        <!-- Top Templates Chart (Column Chart) -->
                        <Border
                            Grid.Column="1"
                            Background="{ThemeResource SystemControlAcrylicElementBrush}"
                            BorderBrush="{ThemeResource SystemControlForegroundBaseMediumLowBrush}"
                            BorderThickness="1"
                            CornerRadius="8"
                            Padding="20"
                            Margin="12,0,0,0">
                            <StackPanel Spacing="12">
                                <TextBlock
                                    Text="Top Templates"
                                    FontSize="18"
                                    FontWeight="SemiBold" />
                                <lvc:CartesianChart
                                    x:Name="TopTemplatesChart"
                                    Height="300" />
                            </StackPanel>
                        </Border>
                    </Grid>
                </StackPanel>

                <!-- Loading Indicator -->
                <ProgressRing 
                    x:Name="DashboardLoadingProgressRing"
                    Height="40"
                    Width="40"
                    HorizontalAlignment="Center"
                    Visibility="Collapsed" />
            </StackPanel>
        </ScrollViewer>

        <!-- Canvas Manager View -->
        <Grid 
            x:Name="CanvasManagerView"
            Grid.Row="1"
            Visibility="Collapsed">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <!-- Header -->
            <StackPanel Grid.Row="0" Orientation="Horizontal" Spacing="12" Padding="24">
                <TextBlock 
                    Text="Canvas Manager"
                    FontSize="32"
                    FontWeight="Bold" />
            </StackPanel>

            <!-- Canvas List -->
            <ScrollViewer Grid.Row="1" Padding="24">
                <StackPanel Spacing="16">
                    <ProgressRing 
                        x:Name="CanvasManagerLoadingProgressRing"
                        Height="40"
                        Width="40"
                        HorizontalAlignment="Center"
                        Visibility="Collapsed" />

                    <GridView
                        x:Name="CanvasesGridView"
                        SelectionMode="Single"
                        IsItemClickEnabled="True"
                        ItemClick="CanvasesGridView_ItemClick"
                        Visibility="Visible">
                        <GridView.ItemTemplate>
                            <DataTemplate>
                                <Border
                                    Background="{ThemeResource SystemControlAcrylicElementBrush}"
                                    BorderBrush="{ThemeResource SystemControlForegroundBaseMediumLowBrush}"
                                    BorderThickness="1"
                                    CornerRadius="8"
                                    Padding="16"
                                    Width="300"
                                    Height="200">
                                    <Border.Shadow>
                                        <ThemeShadow />
                                    </Border.Shadow>
                                    <StackPanel Spacing="8">
                                        <TextBlock 
                                            Text="{Binding Canvas.Name}"
                                            FontWeight="SemiBold"
                                            FontSize="18"
                                            TextTrimming="CharacterEllipsis" />
                                        <TextBlock 
                                            FontSize="14"
                                            Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}"
                                            TextTrimming="CharacterEllipsis">
                                            <Run Text="Profile: " />
                                            <Run Text="{Binding Canvas.Profile.Name}" />
                                        </TextBlock>
                                        <TextBlock 
                                            FontSize="12"
                                            Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}">
                                            <Run Text="Created: " />
                                            <Run Text="{Binding FormattedCreatedDate}" />
                                        </TextBlock>
                                        <TextBlock 
                                            FontSize="12"
                                            Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}">
                                            <Run Text="Modified: " />
                                            <Run Text="{Binding FormattedLastModifiedDate}" />
                                        </TextBlock>
                                        <StackPanel Orientation="Horizontal" Spacing="8" Margin="0,8,0,0">
                                            <Button
                                                Content="Open"
                                                Click="OpenCanvasButton_Click"
                                                Tag="{Binding}"
                                                Style="{StaticResource AccentButtonStyle}"
                                                ToolTipService.ToolTip="Open this canvas in the drawing page"
                                                AutomationProperties.Name="Open Canvas"
                                                AutomationProperties.HelpText="Click to open this canvas in the drawing page" />
                                            <Button
                                                Content="Delete"
                                                Click="DeleteCanvasButton_Click"
                                                Tag="{Binding}"
                                                Style="{StaticResource DefaultButtonStyle}"
                                                ToolTipService.ToolTip="Delete this canvas (cannot be undone)"
                                                AutomationProperties.Name="Delete Canvas"
                                                AutomationProperties.HelpText="Click to delete this canvas. This action cannot be undone" />
                                        </StackPanel>
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </GridView.ItemTemplate>
                    </GridView>

                    <TextBlock
                        x:Name="EmptyStateTextBlock"
                        Text="No canvases available. Create a canvas from the Home page."
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        FontSize="16"
                        Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}"
                        Visibility="Collapsed" />
                </StackPanel>
            </ScrollViewer>
        </Grid>
    </Grid>
</Page>
